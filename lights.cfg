#################################################
# Neopixel definitions
#################################################
[neopixel matchstick_left]
pin: PC6
chain_count: 10
color_order: GRB
initial_RED: 0.0
initial_GREEN: 0.0
initial_BLUE: 0.0

[neopixel matchstick_right]
pin: PA9
chain_count: 10
color_order: GRB
initial_RED: 0.0
initial_GREEN: 0.0
initial_BLUE: 0.0

#################################################
# Effects
#################################################
[led_effect case_standby]
leds:
    neopixel:matchstick_left
    neopixel:matchstick_right
autostart: false
frame_rate: 24
layers:
    static 0 0 add (0, 0.6, 0.78)

[led_effect case_homing_left]
leds:
    neopixel:matchstick_left
autostart: false
frame_rate: 24
layers:
    breathing 12 1 add (0.0,0.6,0.2),(0.0, 0.1, 0.03)
    chase 0.5 0.75 add (0.0,0.6,0.2),(0.0, 0.1, 0.2),(0.0,0.05,0.2)

[led_effect case_homing_right]
leds:
    neopixel:matchstick_right
autostart: false
frame_rate: 24
layers:
    breathing 12 1 add (0.0,0.6,0.2),(0.0, 0.1, 0.03)
    chase 0.5 0.75 add (0.0,0.6,0.2),(0.0, 0.1, 0.2),(0.0,0.05,0.2)

[led_effect case_leveling_left]
leds:
    neopixel:matchstick_left
autostart: false
frame_rate: 24
layers:
    comet 0.75 1 top (0, 0.28, 0.67),(0.32, 0.10, 0.77),(0.59, 0, 0.59)

[led_effect case_leveling_right]
leds:
    neopixel:matchstick_right
autostart: false
frame_rate: 24
layers:
    comet 0.75 1 top (0, 0.28, 0.67),(0.32, 0.10, 0.77),(0.59, 0, 0.59)

[led_effect case_meshing]
leds:
    neopixel:matchstick_left
    neopixel:matchstick_right
autostart: false
frame_rate: 24 
layers:
    comet 0.5 0.5 add (0.59, 0, 0.59),(0.38, 0.22, 0.91),(0, 0.28, 0.67)
    comet -0.5 0.5 add (0.41, 1, 0.41),(0.62, 0.78, 0.9),(1, 0.72, 0.33)

[led_effect case_party_time]
leds:
    neopixel:matchstick_left
    neopixel:matchstick_right
autostart: false
frame_rate: 24
layers:
    strobe 1 1.5 add (1.0, 0.0, 0.0),(1.0,1.0,0.0),(0.0, 1.0, 0.0),(0.0,1.0,1.0),(0.0, 0.0, 1.0),(1.0,0.0,1.0)
    twinkle 5 0.05 add (1.0, 0.0, 0.0),(1.0,1.0,0.0),(0.0, 1.0, 0.0),(0.0,1.0,1.0),(0.0, 0.0, 1.0),(1.0,0.0,1.0)
  
[led_effect case_printing]
leds:
    neopixel:matchstick_left
    neopixel:matchstick_right
autostart: false
frame_rate: 24
layers:
    static 0 1 top (0.5,0.5,0.4)

[led_effect critical_error]
leds:
    neopixel:matchstick_left
    neopixel:matchstick_right
autostart: false
frame_rate: 24
run_on_error: true
layers:
    strobe 1 1.5 add (1.0, 1.0,1.0)
    breathing 2 0 difference (0.95,0.0,0.0)
    static 1 0 top (1.0,0.0,0.0)

#################################################
# Macros
#################################################
[gcode_macro led_blinkinglights]
gcode:
    STOP_LED_EFFECTS ;cancel all others
    SET_LED_EFFECT EFFECT=critical_error ; This activates all LEDs

[gcode_macro led_homing]
gcode: 
    STOP_LED_EFFECTS ;cancel all others
    SET_LED_EFFECT EFFECT=case_homing_left
    SET_LED_EFFECT EFFECT=case_homing_right

[gcode_macro led_leveling]
gcode:
	STOP_LED_EFFECTS ;cancel all others
    SET_LED_EFFECT EFFECT=case_leveling_left
    SET_LED_EFFECT EFFECT=case_leveling_right

[gcode_macro led_meshing]
gcode:
	STOP_LED_EFFECTS ;cancel all others
    SET_LED_EFFECT EFFECT=case_meshing

[gcode_macro led_case_off]
gcode:
    STOP_LED_EFFECTS

[gcode_macro led_party_time]
gcode:
 	STOP_LED_EFFECTS ;cancel all others
    SET_LED_EFFECT EFFECT=case_party_time

[gcode_macro led_printing]
gcode:
 	STOP_LED_EFFECTS ;cancel all others
    SET_LED_EFFECT EFFECT=case_printing

[gcode_macro led_standby]
gcode:
  STOP_LED_EFFECTS ;cancel all others
  SET_LED_EFFECT EFFECT=case_standby

# [gcode_macro CASE_LIGHT]
# variable_current_brightness: 0
# gcode:
#     {% set r = params.R|default(1)|float %}
#     {% set g = params.G|default(1)|float %}
#     {% set b = params.B|default(1)|float %}
#     {% set brightness = params.VALUE|default(1)|float %}

#     {% if (brightness < 0 or brightness > 1) %}
#       {% set brightness = 1 %}
#       M118 brightness cannot be lower than 0 and greater than 1
#     {% endif %}

#     SET_GCODE_VARIABLE MACRO=CASE_LIGHT VARIABLE=current_brightness VALUE={brightness}
#     SET_LED LED=party_1 RED={r*brightness} GREEN={g*brightness} BLUE={b*brightness}
#     SET_LED LED=party_2 RED={r*brightness} GREEN={g*brightness} BLUE={b*brightness}

# [gcode_macro WALKING_LIGHTS]
# gcode:
#     {% set r = params.R|default(1)|float %}
#     {% set g = params.G|default(1)|float %}
#     {% set b = params.B|default(1)|float %}

#     {% set r_o = params.RO|default(0)|float %}
#     {% set g_o = params.GO|default(0)|float %}
#     {% set b_o = params.BO|default(0)|float %}

#     {% set delay = params.DELAY|default(50)|int %}
#     {% set loops = params.LOOPS|default(3)|int %}


#   {% for startup in range(loops) %}
#     {% for ledoffset in range(10) %}
#       SET_LED LED=party_1 RED={r} GREEN={g} BLUE={b} INDEX={1 + ledoffset} TRANSMIT=1
#       SET_LED LED=party_2 RED={r} GREEN={g} BLUE={b} INDEX={1 + ledoffset} TRANSMIT=1
#       G4 P{delay}  
#     {% endfor %}
#     {% for ledoffset in range(10) %}
#       SET_LED LED=party_1 RED={r_o} GREEN={g_o} BLUE={b_o} INDEX={1 + ledoffset} TRANSMIT=1
#       SET_LED LED=party_2 RED={r_o} GREEN={g_o} BLUE={b_o} INDEX={1 + ledoffset} TRANSMIT=1
#       G4 P{delay}  
#     {% endfor %}
#   {% endfor %}
#   SET_LED LED=party_1 RED=0 GREEN=0 BLUE=0
#   SET_LED LED=party_2 RED=0 GREEN=0 BLUE=0